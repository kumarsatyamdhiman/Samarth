<parameter name="content"><?php

// Manual Database Setup Script
echo "=== Manual Database Setup for शिक्षा Implementation ===\n\n";

try {
    // Connect to SQLite database
    $dbPath = __DIR__ . '/database/database.sqlite';
    $pdo = new PDO("sqlite:$dbPath");
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
    
    echo "✅ Connected to database: $dbPath\n\n";
    
    // Create users table
    echo "Creating users table...\n";
    $pdo->exec("
        CREATE TABLE IF NOT EXISTS users (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            username VARCHAR(255) UNIQUE NOT NULL,
            email VARCHAR(255) UNIQUE NOT NULL,
            password VARCHAR(255) NOT NULL,
            first_name VARCHAR(255),
            last_name VARCHAR(255),
            phone VARCHAR(20),
            date_of_birth DATE,
            gender VARCHAR(10),
            is_active BOOLEAN DEFAULT 1,
            email_verified_at TIMESTAMP NULL,
            last_login_at TIMESTAMP NULL,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        )
    ");
    echo "✅ users table created\n";
    
    // Create user_profiles table
    echo "Creating user_profiles table...\n";
    $pdo->exec("
        CREATE TABLE IF NOT EXISTS user_profiles (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            user_id INTEGER NOT NULL,
            bio TEXT,
            location VARCHAR(255),
            website VARCHAR(255),
            avatar VARCHAR(255),
            education_preferences TEXT,
            preferred_language VARCHAR(10) DEFAULT 'hindi',
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            FOREIGN KEY (user_id) REFERENCES users (id) ON DELETE CASCADE
        )
    ");
    echo "✅ user_profiles table created\n";
    
    // Create education table
    echo "Creating education table...\n";
    $pdo->exec("
        CREATE TABLE IF NOT EXISTS education (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            type VARCHAR(50) NOT NULL,
            name_hindi VARCHAR(255) NOT NULL,
            name_english VARCHAR(255),
            description_hindi TEXT,
            description_english TEXT,
            category VARCHAR(100),
            level VARCHAR(50),
            suitable_streams TEXT,
            related_interests TEXT,
            eligibility TEXT,
            duration VARCHAR(100),
            career_prospects TEXT,
            average_salary VARCHAR(100),
            exam_pattern TEXT,
            frequency VARCHAR(50),
            official_website VARCHAR(255),
            is_active BOOLEAN DEFAULT 1,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        )
    ");
    echo "✅ education table created\n";
    
    // Create goals table (if not exists)
    echo "Creating goals table...\n";
    $pdo->exec("
        CREATE TABLE IF NOT EXISTS goals (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            title_hindi VARCHAR(255) NOT NULL,
            title_english VARCHAR(255),
            description_hindi TEXT,
            description_english TEXT,
            category VARCHAR(100),
            target_age_group VARCHAR(50),
            estimated_time_hours INTEGER DEFAULT 1,
            points_reward INTEGER DEFAULT 10,
            is_active BOOLEAN DEFAULT 1,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        )
    ");
    echo "✅ goals table created\n";
    
    // Create challenges table (if not exists)
    echo "Creating challenges table...\n";
    $pdo->exec("
        CREATE TABLE IF NOT EXISTS challenges (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            title_hindi VARCHAR(255) NOT NULL,
            title_english VARCHAR(255),
            description_hindi TEXT,
            description_english TEXT,
            category VARCHAR(100),
            estimated_time_minutes INTEGER DEFAULT 30,
            points_reward INTEGER DEFAULT 5,
            is_active BOOLEAN DEFAULT 1,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        )
    ");
    echo "✅ challenges table created\n";
    
    // Create user_progress table (if not exists)
    echo "Creating user_progress table...\n";
    $pdo->exec("
        CREATE TABLE IF NOT EXISTS user_progress (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            user_id INTEGER NOT NULL,
            goal_id INTEGER NOT NULL,
            progress_percentage DECIMAL(5,2) DEFAULT 0.00,
            status VARCHAR(50) DEFAULT 'in_progress',
            started_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            completed_at TIMESTAMP NULL,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            FOREIGN KEY (user_id) REFERENCES users (id) ON DELETE CASCADE,
            FOREIGN KEY (goal_id) REFERENCES goals (id) ON DELETE CASCADE
        )
    ");
    echo "✅ user_progress table created\n";
    
    // Create user_challenges table (if not exists)
    echo "Creating user_challenges table...\n";
    $pdo->exec("
        CREATE TABLE IF NOT EXISTS user_challenges (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            user_id INTEGER NOT NULL,
            challenge_id INTEGER NOT NULL,
            is_completed BOOLEAN DEFAULT 0,
            completed_at TIMESTAMP NULL,
            points_earned INTEGER DEFAULT 0,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            FOREIGN KEY (user_id) REFERENCES users (id) ON DELETE CASCADE,
            FOREIGN KEY (challenge_id) REFERENCES challenges (id) ON DELETE CASCADE
        )
    ");
    echo "✅ user_challenges table created\n";
    
    echo "\n=== Inserting Sample Data ===\n\n";
    
    // Insert test user
    echo "Inserting test user...\n";
    $stmt = $pdo->prepare("
        INSERT INTO users (username, email, password, first_name, last_name, is_active) 
        VALUES (?, ?, ?, ?, ?, ?)
    ");
    $stmt->execute(['test', 'test@example.com', password_hash('password', PASSWORD_DEFAULT), 'Test', 'User', 1]);
    echo "✅ Test user created (ID: " . $pdo->lastInsertId() . ")\n";
    
    // Insert sample education data
    echo "Inserting education data...\n";
    
    // Streams
    $educationData = [
        ['stream', 'Science (PCM/PCB)', 'Science (PCM/PCB)', 'गणित, भौतिकी, रसायन या जीव विज्ञान के साथ विज्ञान स्ट्रीम।', 'general'],
        ['stream', 'Commerce', 'Commerce', 'व्यापार, लेखा, अर्थशास्त्र के साथ कॉमर्स स्ट्रीम।', 'general'],
        ['stream', 'Arts/Humanities', 'Arts/Humanities', 'साहित्य, इतिहास, भूगोल, समाजशास्त्र आदि के साथ आर्ट्स स्ट्रीम।', 'general'],
        ['stream', 'Vocational/Skill', 'Vocational/Skill', 'व्यावसायिक कौशल और तकनीकी शिक्षा के साथ स्किल स्ट्रीम।', 'general'],
        
        // Sectors
        ['sector', 'इंजीनियरिंग और टेक्नोलॉजी', 'Engineering & Technology', 'कंप्यूटर, मैकेनिकल, सिविल, इलेक्ट्रॉनिक्स आदि में इंजीनियरिंग।', 'engineering'],
        ['sector', 'स्वास्थ्य और चिकित्सा', 'Health & Medicine', 'MBBS, नर्सिंग, फार्मेसी, पैरामेडिकल आदि में करियर।', 'health'],
        ['sector', 'वाणिज्य और वित्त', 'Commerce & Finance', 'चार्टर्ड अकाउंटेंसी, बैंकिंग, फाइनेंस, बिजनेस एडमिनिस्ट्रेशन।', 'commerce'],
        
        // Exams
        ['exam', 'JEE Main', 'JEE Main', 'राष्ट्रीय तकनीकी संस्थानों में दाखिले के लिए मुख्य परीक्षा।', 'engineering', 'after_12th'],
        ['exam', 'NEET-UG', 'NEET-UG', 'चिकित्सा और दंत कॉलेजों में दाखिले के लिए राष्ट्रीय परीक्षा।', 'health', 'after_12th'],
        ['exam', 'CUET-UG', 'CUET-UG', 'केंद्रीय विश्वविद्यालयों में स्नातक कोर्सों के लिए सामान्य प्रवेश परीक्षा।', 'general', 'after_12th']
    ];
    
    $stmt = $pdo->prepare("
        INSERT INTO education (type, name_hindi, name_english, description_hindi, category, level) 
        VALUES (?, ?, ?, ?, ?, ?)
    ");
    
    foreach ($educationData as $data) {
        $stmt->execute($data);
    }
    echo "✅ Sample education data inserted\n";
    
    echo "\n=== Database Setup Complete ===\n";
    echo "✅ All tables created successfully\n";
    echo "✅ Test user created (username: test, password: password)\n";
    echo "✅ Sample education data inserted\n";
    echo "\n=== Next Steps ===\n";
    echo "1. User model is now correctly configured to use 'users' table\n";
    echo "2. All database relationships are established\n";
    echo "3. Education functionality is ready to use\n";
    echo "4. Test the application with username: test, password: password\n";
    
} catch (Exception $e) {
    echo "❌ Error: " . $e->getMessage() . "\n";
    exit(1);
}
</parameter>
